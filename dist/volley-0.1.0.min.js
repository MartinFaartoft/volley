/*! volley - v0.1.0 - 2016-06-18
* https://github.com/martinfaartoft/volley/
* Copyright (c) 2016 Piston.js <martin.faartoft@gmail.com>; Licensed MIT*/
var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},volley;(function(t){var e=function(e){function i(t,i,s,o){e.call(this,t,i,o),this.pos=t,this.accel=s,this.friction=new ps.Vector(1e-4,.001),this.collided=0,this.mass=25}return __extends(i,e),i.prototype.render=function(t){t.fillStyle="orange",t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.fill()},i.prototype.update=function(t,e){this.checkWallCollisions(e),this.checkNetCollision(e),this.collided>0&&(this.collided-=t),this.accelerate(t)},i.prototype.accelerate=function(t){this.speed=this.speed.add(this.accel.multiply(t)),this.speed.x*=1-this.friction.x,this.speed.y*=1-this.friction.y,this.pos=this.pos.add(this.speed.multiply(t))},i.prototype.checkNetCollision=function(e){if(!(this.collided>0)){var i=e.net.pos.x,s=e.net.pos.y-t.Net.HEIGHT,o=this.pos.x>i-this.radius&&this.pos.x<i+this.radius+t.Net.THICKNESS,n=this.pos.y>s-this.radius+20&&this.pos.y<e.net.pos.y;o&&n&&(this.speed.x*=-1,this.collided=.1)}},i.prototype.checkWallCollisions=function(t){this.pos.y+this.radius>=t.dimensions.y&&this.speed.y>0?this.speed.y*=-1:0>this.pos.y-this.radius&&0>this.speed.y&&(this.speed.y*=-1),0>this.pos.x-this.radius&&0>this.speed.x?this.speed.x*=-1:this.pos.x+this.radius>t.dimensions.x&&this.speed.x>0&&(this.speed.x*=-1)},i.prototype.collideWith=function(t){if(!(this.collided>0)){this.collided=.1;var e=25,i=100,s=this.pos.x,o=this.pos.y,n=t.pos.x,l=t.pos.y,h=[n-s,l-o],r=this.magnitude(h),p=[h[0]/r,h[1]/r],c=[-p[1],p[0]],a=[this.speed.x,this.speed.y],d=[t.speed.x,t.speed.y],y=this.dotProduct(p,a),u=this.dotProduct(c,a),f=this.dotProduct(p,d),P=this.dotProduct(c,d),x=u,v=P,w=this.calculateNormalVelocity(y,f,e,i),g=this.calculateNormalVelocity(f,y,i,e),m=[w*p[0],w*p[1]],S=[g*p[0],g*p[1]],I=[x*c[0],x*c[1]],b=[v*c[0],v*c[1]],E=this.add(m,I);this.add(S,b),this.speed=new ps.Vector(E[0],E[1])}},i.prototype.add=function(t,e){return[t[0]+e[0],t[1]+e[1]]},i.prototype.magnitude=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},i.prototype.dotProduct=function(t,e){return t[0]*e[0]+t[1]*e[1]},i.prototype.calculateNormalVelocity=function(t,e,i,s){return(t*(i-s)+2*s*e)/(i+s)},i}(ps.Entity);t.Ball=e})(volley||(volley={}));var volley;(function(t){(function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"})(t.PlayerDirection||(t.PlayerDirection={}));var e=t.PlayerDirection,i=function(t){function i(e,i,s,o,n){t.call(this,e,new ps.Vector(0,0),s),this.color=i,this.keys=o,this.direction=n,this.accel=new ps.Vector(0,900),this.isJumping=!1,this.mass=100}return __extends(i,t),i.prototype.render=function(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI,!0),t.fill(),this.renderEye(t)},i.prototype.renderEye=function(t){var i=this.pos.x+this.radius/2*(this.direction===e.Right?-1:1),s=this.pos.y-this.radius/2,o=i+2*(this.direction===e.Right?-1:1);t.fillStyle="white",t.beginPath(),t.arc(i,s,5,0,2*Math.PI),t.fill(),t.fillStyle="black",t.beginPath(),t.arc(o,s,2,0,2*Math.PI),t.fill()},i.prototype.update=function(t,e){this.isJumping&&(this.pos.y<e.dimensions.y?this.accelerate(t):(this.speed.y=0,this.pos.y=e.dimensions.y,this.isJumping=!1)),this.pos.x+=this.speed.x*t,this.pos.y+=this.speed.y*t},i.prototype.accelerate=function(t){this.speed.x+=this.accel.x*t,this.speed.y+=this.accel.y*t},i.prototype.collideWith=function(){},i.prototype.handleInput=function(){this.speed.x=0,ps.isKeyDown(this.keys[0])?this.speed.x=-300:ps.isKeyDown(this.keys[1])&&(this.speed.x=300),ps.isKeyDown(this.keys[2])&&(this.isJumping||(this.isJumping=!0,this.speed.y=-300,this.pos.y-=1))},i}(ps.Entity);t.Player=i})(volley||(volley={}));var volley;(function(t){var e=function(t){function e(){t.call(this,new ps.Point(512,768),new ps.Vector(0,0),0)}return __extends(e,t),e.prototype.render=function(t){t.fillStyle="purple",t.fillRect(this.pos.x,this.pos.y,e.THICKNESS,-e.HEIGHT)},e.HEIGHT=300,e.THICKNESS=10,e}(ps.Entity);t.Net=e})(volley||(volley={}));var volley;(function(t){var e=function(e){function i(){e.call(this,new ps.Point(512+i.RADIUS,768-t.Net.HEIGHT),new ps.Vector(0,0),i.RADIUS),this.mass=100}return __extends(i,e),i.prototype.render=function(t){t.fillStyle="purple",t.beginPath(),t.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),t.fill()},i.prototype.collideWith=function(){},i.RADIUS=t.Net.THICKNESS/2,i}(ps.Entity);t.NetTop=e})(volley||(volley={}));var volley;(function(t){var e=function(e){function i(i,s){e.call(this,i),this.dimensions=i,this.debug=s,this.ball=new t.Ball(new ps.Point(500,100),new ps.Vector(200,0),new ps.Vector(0,400),50),this.leftPlayer=new t.Player(new ps.Point(200,768),"green",50,["a","d","w"],t.PlayerDirection.Left),this.rightPlayer=new t.Player(new ps.Point(890,768),"blue",50,["LEFT","RIGHT","UP"],t.PlayerDirection.Right),this.net=new t.Net,this.netTop=new t.NetTop}return __extends(i,e),i.prototype.render=function(t){t.fillStyle="black",t.fillRect(0,0,this.dimensions.x,this.dimensions.y),this.net.render(t),this.netTop.render(t),this.ball.render(t,this),this.leftPlayer.render(t,this),this.rightPlayer.render(t,this)},i.prototype.update=function(t){this.rightPlayer.handleInput(),this.leftPlayer.handleInput(),ps.detectCircularCollision(this.ball,this.leftPlayer,this),ps.detectCircularCollision(this.ball,this.rightPlayer,this),ps.detectCircularCollision(this.ball,this.netTop,this),this.ball.update(t,this),this.leftPlayer.update(t,this),this.rightPlayer.update(t,this)},i}(ps.BaseGameState);t.VolleyState=e})(volley||(volley={}));var volley;(function(t){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=1024,e.height=768,document.body.appendChild(e);var s=!1,o=new ps.Vector(e.width,e.height),n=new t.VolleyState(o,s),l=new ps.Engine(n,i,s);l.run()})(volley||(volley={}));